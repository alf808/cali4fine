California's Contributions to 2016 Presidential Campaigns by Alf Maglalang
========================================================

```{r echo=FALSE, message=FALSE, warning=FALSE, packages}
# Load all of the packages
library(ggplot2)
library(gender)
library(dplyr)
library(GGally)
library(gridExtra)
library(scales)
library(RColorBrewer)
```

I used the dataset "Financial Contributions to Presidential Campaigns by State". I followed Udacity's instructions to download one state. From http://fec.gov/disclosurep/pnational.do on February 26 2016, I downloaded the dataset from California for 2016 presidential election year. It seems that the latest contribution for this dataset was placed on January 29 2016.

## California Presidential Campaign Finance, dataframe capcf
```{r echo=FALSE, Load_the_Data}
# Load the Data for California and some description of data
capcf <- read.csv('P00000001-CA.csv')
# DELETE below
capcf <- subset(capcf, select = -c(row.names, cand_party, rest_name, contbr_fname, gender))
```

# Univariate Plots Section
```{r echo=FALSE, Data_summary}
str(capcf)
summary(capcf)
levels(capcf$cand_nm)

# get a count of contributions per candidate
table(capcf$cand_nm)
# sort frequency table in decreasing order
sort(table(capcf$cand_nm), decreasing = TRUE)
# DELETE below
capcf <- read.csv('P00000001-CA.csv')
```

Most contributions are to Sanders, Clinton, Cruz, and Carson. The top cities where contributions came from are Los Angeles and San Francisco. The mean contribution amount is 262.4 and the median is 50. The minimum contribution is a negative amount, possibly a refund. The maximum contribution is 10800, definitely an outlier.

```{r echo=FALSE, reorder_levels}
# I may reuse the simplefunction below many times to reorder levels
# This code is from http://docs.ggplot2.org/current/geom_bar.html
ReorderSize <- function(x) {
  factor(x, levels = names(sort(table(x))))
}
```

## Add candidates' party affiliations and gender of contributors
```{r echo=FALSE, Assign_party_affiliation}
# grab all the unique candidate names and assign the right party
# according to https://ballotpedia.org/Presidential_candidates,_2016

cand_names <- unique(capcf$cand_nm, incomparables = FALSE)
cand_party <- c("Democrat", "Republican", "Republican", "Republican",
                "Republican", "Democrat", "Republican", "Republican",
                "Republican", "Republican", "Republican", "Republican", 
                "Republican", "Green", "Republican", "Democrat", "Democrat",
                "Republican", "Democrat", "Republican", "Republican", 
                "Republican")
cand_lastnm <- c("Sanders", "Rubio", "Christie", "Bush", "Carson", "Clinton",
               "Kasich", "Trump", "Fiorina", "Cruz", "Paul", "Santorum",
               "Jindal", "Stein", "Huckabee", "Lessig", "Webb", "Pataki",
               "Omalley", "Graham", "Perry", "Walker")
# Verify that I have the correct party and last name for each candidate
data.frame(cand_names, cand_lastnm, cand_party)
```

### Add column cand_party to capcf
```{r echo=FALSE, Add_variable_cand_party}
# Using the cand_names vector to get the party name in cand_party
#capcf$cand_party <- cand_party[match(capcf$cand_nm, cand_names)]

capcf$cand_nm <- cand_lastnm[match(capcf$cand_nm, cand_names)]
# convert capcf$cand_party to a factor (nominal) variable
#capcf$cand_party <- factor(capcf$cand_party)
capcf$cand_nm <- factor(capcf$cand_nm)
table(capcf$cand_party)
table(capcf$cand_nm)
```

```{r echo=FALSE, Univariate_Plots}
# Plot contributions by candidate
# Flip the histogram so that candidate names are on vertical axis
ggplot(aes(x = cand_nm), data = capcf) +
  geom_bar() +
  coord_flip() +
  xlab("Presidential Candidates") +
  ggtitle("Number of contributions by candidate")

# reorder by count in descending order using ReorderSize function
ggplot(aes(x = ReorderSize(cand_nm)),
       data = capcf) +
  geom_bar() +
  coord_flip() +
  xlab("Presidential Candidates") +
  ggtitle("Number of contributions by candidate, descending order")
```

```{r echo=FALSE, Plot_contribution_party}
ggplot(aes(x = cand_party), data = capcf) +
  geom_bar() +
  ggtitle("Number of contributions by party")
```

### Add a new column gender to capcf dataframe
The process of adding gender to each contributor involves extracting the first names of contributors, detecting the gender based on first names using the package gender from https://cran.r-project.org/web/packages/gender/index.html. The head and tail of first names are below.

```{r echo=FALSE, eval=FALSE, Extract_first_names}
# get rid of last names from contributors' names, separated by a comma
capcf$rest_name <- sub(".*,\\s*", "", capcf$contbr_nm)
# Extract first names from capcf$rest_name
capcf$contbr_fname <- sub("\\s+.*","", capcf$rest_name)
```
```{r echo=FALSE, Show_first_names}
head(capcf$contbr_fname, n=15)
tail(capcf$contbr_fname, n=15)
```

I used help to get information on gender library: `?gender`
I first ran the gender package on my name.
```
gender("alf", method="ssa", years=c(1932,2012))$gender
```
I noticed that the gender function is very slow. It took nearly a second to run the code above. It took nearly 12 minutes to run the gender function on
1000 first names.

I wrote the ApplyGender function so that I can run the function remotely every 8 hours.

```{r echo=FALSE, ApplyGender_function}
# get gender every 45000 rows and write to file 

ApplyGender <- function(beg, end) {
  for (i in beg:end) {
    # The gender function throws an error and ceases operation if gender
    # cannot be predicted. So I took the character length of tempgender. If it
    # is zero length use "unknown" as gender, otherwise use predicted gender
    tempgender <- gender(as.character(capcf$contbr_fname[i]), method="ssa",
                         years=c(1932,2012))$gender
    capcf$gender[i] <- ifelse(length(tempgender) > 0, tempgender, "unknown")
    # the line of code below is for viewing the status of the process
    # print(i); print(capcf$gender[i])
  }
  # After the loop finishes, write the dataframe to a csv-formatted file
  # using the last row processed as part of the file name
  filenm <- paste("capcf_",end, sep="")
  filenm <- paste(filenm,".csv", sep="")
  write.csv(capcf, file=filenm, row.names=FALSE, na="")
}

```

```{r echo=FALSE, eval=FALSE, Run_ApplyGender}
# Run ApplyGender function every 8 hours. After a few hours
ApplyGender(1, 45000)
ApplyGender(45001, 90000)
ApplyGender(90001, 135000)
ApplyGender(135001, 180478)
```

I continued to clean up the gender using the prefix, i.e., if the contributor used a prefix. If contributor's name contains a MR, MRS, or MS, I changed *unknown* to appropriate gender. After I invoked the last of the ApplyGender, dataframe had 5712 *unknown*s in the *gender* column. After more clean up, the last count of gender types is below.

```{r echo=FALSE, eval=FALSE, Clean_up_unknown_gender}
capcf$gender[grepl("MR\\.",capcf$rest_name)&(capcf$gender=="unknown")] <- "male"
capcf$gender[grepl("MR\\.",capcf$rest_name)&(capcf$gender=="female")] <- "male"
capcf$gender[grepl("MS\\.",capcf$rest_name)&(capcf$gender=="male")] <- "female"
capcf$gender[grepl("MRS\\.",capcf$rest_name)&(capcf$gender=="male")] <- "female"
```
```{r echo=FALSE, Show_genders}
table(capcf$gender)
# ratio for each gender
table(capcf$gender)[1:3]/length(capcf$gender)
```

```{r echo=FALSE, Plot_contribution_count_gender}
ggplot(aes(x = gender), data = capcf) +
  geom_bar() +
  ggtitle("Number of contributions by gender")
```

### Plots of contributions by gender faceted by candidate names
```{r echo=FALSE, Plot_contribution_count_gender_per_candidate}
ggplot(aes(x = gender), data = subset(capcf, gender != "unknown")) +
  geom_bar() +
  ggtitle("Number of contributions by gender per candidate") +
  facet_wrap(~ cand_nm, scales = "free_x")

# see ReorderSize function above
ggplot(aes(ReorderSize(cand_nm)), data = subset(capcf, gender != "unknown")) +
  geom_bar() +
  ggtitle("Number of contributions by gender per candidate") +
  facet_wrap(~ gender) +
  coord_flip() +
  xlab("Presidential Candidates")

# count summary of each candidates by gender
by(capcf$cand_nm, capcf$gender, summary)
```

I temporarily took out the *unknown* *gender* from 2 plots above. The contributions from *unknown* gender seemed negligible compared to the number of contributions from females and males.

Only Hillary clinton proportionally has more contributions from females. Even Carly Fiorina received more contributions from males than from females. But Bernard Sanders still received more contributions from females than any other candidate. Not only did Sanders receive the most contributions from females, but also the most from males.

```{r echo=FALSE, Plot_contribution_amount_frequency}
ggplot(aes(x = contb_receipt_amt),
       data = subset(capcf, contb_receipt_amt > 0 & contb_receipt_amt < 5000)) +
  geom_histogram(binwidth = 100) +
  xlab("contribution amounts") +
  ggtitle("Count of Contribution amounts") +
  scale_x_continuous(breaks = seq(0, 5000, 500))
```

Most of the contributions are at or below 250. There are other spikes around 500, 1000, and strangely at 2750.

The result below shows top 10 contribution amounts which correspond to the spikes on the plot above. Contributions of $50, $100, and $25 are top 3 donation amounts, followed by $10 and $250 amounts. I noticed that the amount $2700 follows closely in the top sixth which corresponds to the last spike in the plot above.

```{r echo=FALSE, table_contribution_amount_count}
# the code below required a lot of experimentation. I first took a subset
# of amounts greater than zero, table the contribution amounts of the
# subset, then sorted the result in decreasing order, and taking the
# top 10 results.
sort(table((subset(capcf, contb_receipt_amt > 0)$contb_receipt_amt)),
     decreasing = TRUE)[1:10]
```

### Top 20 occupations with most number of contributions
```{r echo=FALSE, Contributors_by_occupation}
# Plot top 20 occupations by number of contributions
capcf.top_occupation <- capcf %>%
  filter(contbr_occupation != "",
         contbr_occupation != "INFORMATION REQUESTED PER BEST EFFORTS",
         contbr_occupation != "INFORMATION REQUESTED") %>%
  count(contbr_occupation) %>%
  top_n(20, n)

ggplot(aes(x = reorder(contbr_occupation, n), y = n), data = capcf.top_occupation) +
  geom_bar(stat = "identity") +
  xlab("Contributors' occupation") +
  ylab("Number of contributions") +
  ggtitle("Top 20 contributors by occupation") +
  coord_flip() +
  scale_y_continuous(breaks = seq(0, 40000, 5000))
```

Many contributions came from the retired and the unemployed whose combined number of contributions comprised one-third of the total 180478 contributions. Attorneys, homemakers, teachers, engineers, and physicians came at distant third, fourth,... nth places. I'll examine later what the total amount of contributions per occupation will demonstrate.

### Contributions over time
```{r echo=FALSE, Date_conversion_initial_plot}
# Convert dates from strings to the Date datatype
capcf$contb_receipt_dt <- as.Date(capcf$contb_receipt_dt, "%d-%b-%y")
# Free plotting
ggplot(aes(x = contb_receipt_dt), data = capcf) +
  geom_bar()
```

The financing activity quickly started around Mar-April 2015. The first substantial spike was around June-July 2015. Then there was an upward trend to a sudden peak around September-October of 2015. Then the density increases around December 2015 with a peak just before the new year of 2016. The increased activity continues until the last spike around the end of January.

All the spikes seem to correspond with the end of quarterly reports. There were probably financing solicitation drives near the following times March 31, June 30, September 30, and December 31 which were the dates from Presidential Campaign Finance Summaries at  http://fec.gov/press/bkgnd/pres_cf/pres_cf_Even.shtml. The last spike on Jan 2016 seems to correspond with the first monthly report of the new year on Jan 31 2016.

```{r echo=FALSE, Candidates_contributions_time}
ggplot(aes(x = contb_receipt_dt), data = capcf) +
  geom_bar() +
  xlab("Date of contributions") +
  facet_wrap(~ cand_nm, ncol = 4)
```

At first glance, Carson, Clinton, Cruz, and especially Sanders had a lot of financing activities. There's some hints of activities from Bush, Christie, and Rubio.

It looks like Sanders contributions count was the only one that passed counts at 500th, 1000th, and 1500th marks. It's the only campaign that looks like there's a true surge. Clinton's activity looks steady. Carson, who's now dropped out of the race, had a good run of financing activity.

### Top 20 cities with most number of contributions
```{r echo=FALSE, Contributions_by_cities}
# Plot top 20 cities by number of contributions
tc <- capcf %>%
  filter(contbr_city != "") %>%
  count(contbr_city) %>%
  top_n(20, n) %>%
  arrange(desc(n))

tc$contbr_city <- factor(tc$contbr_city, levels = tc$contbr_city[order(tc$n)])
tc$crank <- seq(1, 20)

ggplot(aes(x = contbr_city, y = n), data = tc) +
  geom_bar(stat = "identity") +
  xlab("Cities") +
  ylab("Number of contributions") +
  ggtitle("Top 20 sources by cities") +
  coord_flip() +
  scale_y_continuous(breaks = seq(0, 40000, 5000))

# ggplot(aes(x = reorder(contbr_city, n), y = n), data = tc) +
#   geom_bar(stat = "identity") +
#   xlab("Cities") +
#   ylab("Number of contributions") +
#   ggtitle("Top 20 sources by cities") +
#   coord_flip() +
#   scale_y_continuous(breaks = seq(0, 40000, 5000))


```

The big cities are main sources of contributions. That makes sense. I'll examine the amounts later.

### Top 20 zip codes with most number of contributions
```{r echo=FALSE, Contributions_by_zip}
# Convert contbr_zip 5-digit ZIP codes
capcf$contbr_zip <- factor(strtrim(capcf$contbr_zip, 5))

# Plot top 20 cities by number of contributions
capcf.top_zips <- capcf %>%
  filter(contbr_zip != "") %>%
  count(contbr_zip) %>%
  top_n(20, n)

ggplot(aes(x = reorder(contbr_zip, n), y = n), data = capcf.top_zips) +
  geom_bar(stat = "identity") +
  xlab("Zip codes") +
  ylab("Number of contributions") +
  ggtitle("Top 20 sources by zip codes") +
  coord_flip() +
  scale_y_continuous(breaks = seq(0, 2000, 250))
```

The top sources of contributions based on zip codes is not so interesting. But this is preparation for a choropleth map I plan to do based on zip codes in California. The requirements are from this site: https://rpubs.com/arilamstein/zip-vignette-1.

It is interesting to note that the top zip codes are 941xx in San Francisco; 90049, 90046, 90069 in Los Angeles; 94611 Oakland; 90272 Pacific Palisades; and the famed 90210 in Beverly Hills.

# Univariate Analysis

#### What is the structure of your dataset?
There are observations in the dataset with 23 variables -- all factor variables with the exception contbr_receipt_amt (contribution amount) and tran_id (transaction ID). I converted the contribution date, contb_receipt_dt, from a factor to a Date datatype. Some of the levels are cand_nm with 22 levels of presidential candidate names:
```{r echo=FALSE, Candidate_levels}
levels(capcf$cand_nm)
```
candidates' party affiliations:
```{r echo=FALSE, Candidate_parties}
levels(capcf$cand_party)
```
contributors' gender
```{r echo=FALSE, Contributor_gender}
levels(capcf$gender)
```

#### What is/are the main feature(s) of interest in your dataset?
This dataset is relatively large with 180478 observations and 23 variables. The original dataset had 18 variables. The legend of variable names are at: ftp://ftp.fec.gov/FEC/Presidential_Map/2016/DATA_DICTIONARIES/CONTRIBUTOR_FORMAT.txt.

The main features in the dataset are cand_nm (presidential candidates' names) and contb_receipt_amt (contribution amount). The top candidates receiving contributions are Sanders and Clinton (both Democrats) while Republican Cruz and Carson are distant third and fourth.

I added gender and party affiliations which I think will be interesting to examine how they relate to each other and to other variables.

#### What other features in the dataset do you think will help support your investigation into your feature(s) of interest?
After having done the univariate analyses, I also found the contb_receipt_dt (contribution date) interesting in that one can see how the trends and peaks correspond to the frenzy of campaign activities, esp dates of filing at end of quarter and end of month.

The gender of the contributors will show the influence of the sole demographics represented in the dataset.
 
#### Did you create any new variables from existing variables in the dataset?
I created 2 variables, gender and cand_party (candidates' party affiliations). I converted factor contbr_dt to date datatype. I also changed the candidates' names, cand_nm, to just the last names. This makes plotting more readable. I also changed the zip codes from 9 characters into the first 5 characters in preparation for creating a choropleth map of California based on zip codes. It might intimate some other type of demographics perhaps economic status based on zip code.

#### Of the features you investigated, were there any unusual distributions? Did you perform any operations on the data to tidy, adjust, or change the form of the data? If so, why did you do this?
I did not notice any unusual distributions in my initial univariate analyses. As I noted earlier, the spikes in contribution activity with regards to dates corresponded to quarterly reports and monthly reports. I changed the forms of contribution dates in order to plot dates in chronological order; candidates' names for plot readability; and the zip codes in preparation for choropleth map for later analyses.

The most time-consuming part of the preparation of the dataset is adding the gender to the contributors based on first names using the `gender` package from https://cran.r-project.org/web/packages/gender/index.html. It took more than 30 hours. Fortunately, it was mostly unattended since I automated parts of it so I can run it remotely.

My old Windows machine does not behave well with the R stastical program and R-studio. The crashes were unpredictable. It would happen while doing a simple plot or a simple table. To save myself some pain, I had to resort to saving the dataframe to an external file several times a day.

# Bivariate Plots Section

```{r echo=FALSE, eval=FALSE, scatterplot_matrix}
set.seed(1836)
capcf.subset <- subset(capcf, contb_receipt_amt > 0,
                       select = -c(row.names,
                                  rest_name,
                                  contbr_fname,
                                  cmte_id,
                                  cand_nm,
                                  contbr_nm,
                                  contbr_st,
                                  receipt_desc,
                                  memo_text,
                                  file_num,
                                  tran_id,
                                  election_tp,
                                  contbr_city,
                                  contbr_employer,
                                  contbr_occupation,
                                  contbr_zip))
capcf.subset <- capcf.subset[sample.int(nrow(capcf.subset), 10000), ]
names(capcf.subset)
ggpairs(capcf.subset)
```

I experimented with ggpairs a lot. I let it run several times which lasted 90 hours for a whole week -- each time ultimately ending in crashing not only R-studio but also both machines (Windows and Linux) I use for this project. I eventually subset the dataframe down to 8 variables with a few levels for the factor variables. The ugly result is below.

## TODO: put image of ggpair below

```{r echo=FALSE, Bivariate_Plots}
# Total amount contributed
total_contributed <- sum(capcf$contb_receipt_amt)
paste("Total amount contributed to all campaigns:", 
      dollar_format()(total_contributed), sep = " ")

capcf.amount.candidates <- capcf %>%
  group_by(cand_nm) %>%
  summarise(sum(contb_receipt_amt))
data.frame(capcf.amount.candidates)

capcf.amount.parties <- capcf %>%
  group_by(cand_party) %>%
  summarise(sum(contb_receipt_amt))
data.frame(capcf.amount.parties)
```

**WOW!** And a special **wow** to Clinton for having raised almost nearly half of the total take of all the campaigns put together.

For zooming purposes, the boxplots below have been subset for readability. For aggregating, I did not subset since I'm assuming that the refunds will cancel the amounts that were refunded.

```{r echo=FALSE, candidate_amount}
p1 <- ggplot(aes(x = cand_nm, y = contb_receipt_amt), data = subset(capcf, contb_receipt_amt > 0 & contb_receipt_amt < 5000)) +
  geom_boxplot() +
  theme(axis.text.x = element_text(angle = 45))

p2 <- ggplot(aes(x = cand_nm, y = contb_receipt_amt), data = capcf) +
  geom_bar(stat="summary", fun.y=sum) +
  theme(axis.text.x = element_text(angle = 45))

grid.arrange(p1, p2)
```

In plots for number of contributions above, Sanders (> 70,000) and Clinton (> 40,000) had the most number of contributions, with Cruz (> 20,000) and Carson (> 20,000), at distant third and fourth. With total amount raised.

Clinton tops everyone by tens of millions at nearly 22.5 million dollars raised, with Sanders coming at very distant second raising just below 6.25 million.

Nevertheless, small donations for both Sanders and Clinton still make up 75% of number of donations to their campaigns. The mean donations for Sanders' and Clinton's campaigns are below $250. It seems that Carson and Cruz who both cleared 2.5 million mark also relied on small donations.

```{r echo=FALSE, party_amount}
p1 <- ggplot(aes(x = cand_party, y = contb_receipt_amt), data = subset(capcf, contb_receipt_amt > 0 & contb_receipt_amt < 500)) +
  geom_boxplot()

p2 <- ggplot(aes(x = cand_party, y = contb_receipt_amt), data = capcf) +
  geom_bar(stat="summary", fun.y=sum)

grid.arrange(p1, p2)
```

The Democratic party seems to have raised 10 million dollars more than the Republican party. 75% of contributors to each party donated at or below $100 with mean donations at or below $50.

With only 4 Democratic candidates, the Democratic candidates in total clearly outraised the 17 Republican candidates.

```{r echo=FALSE, gender_amount}
p1 <- ggplot(aes(x = gender, y = contb_receipt_amt), data = subset(capcf, contb_receipt_amt > 0 & contb_receipt_amt < 500)) +
  geom_boxplot()

p2 <- ggplot(aes(x = gender, y = contb_receipt_amt), data = capcf) +
  geom_bar(stat="summary", fun.y=sum)

grid.arrange(p1, p2)
```

As seen from the contribution counts above, 53% of the contributors were males, 44% females. Males as a group contributed a total of more than 25 million dollars -- 6 million dollars more than females. But the contribution statistics shows that the distribution appears to be similar among all genders at 75% contributing below $100, with similar means -- with males just above $50, and females just below $50.

```{r echo=FALSE, message=FALSE, warning=FALSE, top_30_cities_amounts}
cta <- capcf %>%
  filter(contb_receipt_amt > 0) %>%
  group_by(contbr_city) %>%
  tally(contb_receipt_amt) %>%
  arrange(desc(n)) %>%
  top_n(30)

cta$contbr_city <- factor(cta$contbr_city, levels = cta$contbr_city[order(cta$n)])

ggplot(aes(x = contbr_city, y = n), data = cta) +
  geom_bar(stat = "identity") +
  xlab("Cities") +
  ylab("Total amount of contributions") +
  ggtitle("Top 30 cities by total amounts") +
  coord_flip()
```

I took the top 30 cities based on total amounts contributed. I noticed that some of the top 20 contributing cities in terms of count disappeared when I examined the aggregate by cities -- notably Walnut Creek, Bakersfield, Santa Cruz, Fresno, and Santa Rosa.

And some top contributing cities in terms of amount did not appear in top 20 contribution counts -- notably Pacific Palisades, Los Altos, Atherton, Sherman Oaks, and nearly all the cities in the bottom of the top 30, excepting Long Beach.

This might have something to do with economic demographics in those cities. I'll have to examine the data more closely.

```{r echo=FALSE, contbr_date_amount}
ggplot(aes(x = contb_receipt_dt, y = contb_receipt_amt), data = subset(capcf, contb_receipt_amt > 0 & contb_receipt_amt < 6000 & contb_receipt_dt > as.Date("2015-01-01"))) +
  geom_point(alpha=1/20, color = 'orange') +
  scale_y_continuous(breaks = seq(0, 6000, 500)) +
  geom_line(stat = 'summary', fun.y = median) +
  geom_line(stat = 'summary', fun.y = mean, color = 'red')

summary(subset(capcf, contb_receipt_amt > 0 & contb_receipt_amt < 6000 & contb_receipt_dt > as.Date("2015-01-01"))$contb_receipt_amt)
```

### Daily contributions

Other than the frenzy between February and April 2015, presumably the beginning of the official campaigns, the daily median contribution amount stayed below $125. The *mean* geom_line in red shows the daily average contribution amount. Even during the very dense activity near the end of year 2015, the outliers did not offset the average daily contribution that much.

```{r echo=FALSE, contbr_date_tot_amount}
cor.test(as.numeric(capcf$contb_receipt_dt), capcf$contb_receipt_amt, method = "pearson")

ggplot(aes(x = contb_receipt_dt, y = contb_receipt_amt, color = cand_party), data = subset(capcf, contb_receipt_amt > 0 & contb_receipt_dt > as.Date("2015-01-01"))) +
  geom_line(stat = 'summary', fun.y = sum) +
  ggtitle("Daily receipts by party") +
  scale_color_manual(values=c("blue", "green", "red"))
  
  
```

The Republicans took advantage of the quarterly reports with the spikes corresponding to the last day of filing. Which Republican(s) had busy campaign staff?

I did a correlation test between the date and amount. At -.2374, I doubt there's a correlation other than the fact that time is progressive and events occur as time progresses.


```{r echo=FALSE, contbr_date_tot_amount_cand}
ggplot(aes(x = contb_receipt_dt, y = contb_receipt_amt), data = subset(capcf, contb_receipt_amt > 0 & contb_receipt_dt > as.Date("2015-01-01"))) +
  geom_line(stat = 'summary', fun.y = sum) +
  ggtitle("Daily receipts by candidates") +
  facet_wrap(~ cand_nm)
```

It looks like Republican Bush and Rubio had very good days at quarterly filings. But they, especially Bush, also fizzled out by the end of year. Meanwhile, Cruz had a very good end of year 2015 showing.

On the Democratic side, Sanders had a few good days before the end of the year 2015. Clinton had many good days in 2015.

The blank spaces (or lack of daily financial activity) most likely coincide with presidential campaign suspensions, like Jindal, Lessig, Pataki, and Perry. Clinton, Cruz, Rubio and Sanders kept up with the fundraising in the beginning of 2016 up the first monthly report of the year.


# Bivariate Analysis

#### Talk about some of the relationships you observed in this part of the investigation. How did the feature(s) of interest vary with other features in the dataset?

With only 2 continuous variables, namely contb_receipt_amt and contb_receipt_dt, I could only do the scatter plots against each other. I will attempt to color the scatter plots in the multivariate analysis. In fact, I used color in aesthetics to see how candidates and party affiliations relate to these continuous variables.

The campaigns with the most funding activity are also the ones which had notable spikes at end of quarter reports.

Democratic Sanders and Clinton by far outraised any other candidates. In fact, the Democrats raised 66% of the total amount in California with only 4 Democrats against 17 Republicans vying for the highest office in the land.


```{r Correlated_variables}

```


#### Did you observe any interesting relationships between the other features (not the main feature(s) of interest)?

I noticed an interesting relationship between contribution counts and total amounts raised in specific cities. Some of the top contributing cities in terms of count were missing in the top cities in terms of total amounts. I looked at some of the cities concerned. Pacific Palisades and Los Altos have demographics of upper class white residents according to https://en.wikipedia.org/wiki/List_of_California_locations_by_income, https://en.wikipedia.org/wiki/Los_Altos,_California and https://en.wikipedia.org/wiki/Pacific_Palisades,_Los_Angeles.

On the other hand, Walnut Creek and Fresno are more diverse cities in terms of economic classes and ethnic groups. I did not examine the demographics of these 2 cities but a friend did confirm that these 2 cities are primarily populated by low to middle income groups with high ethnic diversity.

#### What was the strongest relationship you found?

Other than what I have already mentioned, I am not convinced yet of the "strongest relationship". Perhaps when I do the multivariate analyses, I might get better relationships. There could possibly be a relationship between female contributors to Clinton's campaign. But male Sanders has attracted more females than Clinton has. The female candidate Fiorina's fundraising activities are negligible in all counts. She's not worth examining with this California dataset.

The demographics in cities and zip codes might also give provide more relationships against party affiliations and presidential candidates.

# Multivariate Plots Section

```{r echo=FALSE, Multivariate_Plots}


# ggplot(aes(x = contb_receipt_dt, y = contb_receipt_amt, color = cand_party), data = subset(capcf, contb_receipt_amt > 0 & contb_receipt_dt > as.Date("2015-01-01"))) +
#   geom_line() +
#   ggtitle("Daily receipts by party") +
#   scale_color_manual(values=c("blue", "green", "red"))

# testsub <- select(capcf, contb_receipt_dt, contb_receipt_amt, cand_nm, cand_party)
temp.subset <- capcf %>%
  filter(contb_receipt_amt > 0, contb_receipt_dt > as.Date("2015-01-01")) %>%
  #select(contb_receipt_dt, contb_receipt_amt, cand_nm, cand_party) %>%
  group_by(contb_receipt_dt, cand_party) %>%
  summarise(n = sum(contb_receipt_amt))

#by(testsub$n, testsub$cand_party, summary)

ggplot(aes(x = contb_receipt_dt, y = n), data = temp.subset) +
  #geom_line() +
  geom_point(alpha = 1/2) +
  geom_smooth(aes(color = cand_party)) +
  scale_y_log10() +
  facet_wrap(~ cand_party) +
  scale_color_manual(values = c("blue", "green", "red"))


ggplot(aes(x = contb_receipt_dt, y = n), data = temp.subset) +
  geom_line(aes(y = cumsum(n), colour = cand_party))
```

I am comparing the daily receipts by party. For scaling purposes, I scaled the y-axis logarithmically. This shows that contributions increased as the campaign progresses for both Democrats and Republicans. The Green party's fundraising looks downward.

```{r}
temp.subset <- capcf %>%
  group_by(cand_party) %>%
  summarise(amt_recv = sum(contb_receipt_amt))

ggplot(aes(x = cand_party, y = amt_recv, fill = cand_party),
       data = temp.subset) +
  geom_bar(stat = "identity") +
  geom_text(aes(label = amt_recv), stat = "identity", size = 4, vjust = -.4) +
  ylab("Contribution Received") +
  ggtitle("Contribution Received by Political Party") +
  scale_fill_manual(values = c("blue", "green", "red"))
  #scale_y_continuous(label = comma)
```



```{r, echo = FALSE}
temp.subset <- capcf %>%
  group_by(cand_party, cand_nm) %>%
  summarise(
    amt_rcvd = sum(contb_receipt_amt),
    mean_donations = mean(contb_receipt_amt),
    donor_count = n()
  ) %>%
  ungroup() %>%
  arrange(amt_rcvd)
#temp.subset

temp.subset$cand_nm <- factor(temp.subset$cand_nm,
  levels = temp.subset[order(temp.subset$amt_rcvd)]$cand_nm)

# donation received by candidates
ggplot(aes(x = cand_nm, y = amt_rcvd), data = temp.subset) +
  geom_bar(stat = "identity", aes(fill = cand_party)) +
  xlab("Candidates") +
  ylab("Donation Received") +
  coord_flip() +
  scale_y_continuous(label = comma) +
  scale_fill_manual(values = c("blue", "green", "red")) +
  ggtitle("Total Donations Received by each Candidates")
```

We've seen this histogram earlier. This time I added some coloring with based on candidates' party affiliations.

```{r, echo = FALSE, fig.width= 10}
temp.subset = capcf %>%
  group_by(cand_party, cand_nm) %>%
  summarise(
    amt_rcvd = sum(contb_receipt_amt),
    mean_donations = mean(contb_receipt_amt),
    donor_count = n()
    ) %>%
  group_by(cand_party) %>%
  mutate(ratio = round(100 * amt_rcvd/sum(amt_rcvd), 2)) %>%
  arrange(desc(ratio))

temp.subset$cand_nm = factor(temp.subset$cand_nm, 
                        levels = temp.subset[order(temp.subset$ratio)]$cand_nm)

ggplot(aes(x = cand_nm, y = ratio, fill = cand_party), data = temp.subset) +
  geom_bar(stat = "identity") + 
  geom_text(aes(x = cand_nm, y = ratio, label= sprintf("%1.1f%%", ratio)),
            vjust = -.5, size = 3) +
  scale_fill_manual(values = c("blue", "green", "red")) +
  facet_grid(~ cand_party, scales = "free_x", space = "free_x") +
  ylab("Proportion of Donations") +
  xlab("Candidates within respective Parties") +
  theme(legend.position = "top", axis.text.x = element_text(angle = 45))
```

This is the one time in any of my plots that the Green party stood out. As the sole candidate, Stein clearly is the fundraising front-runner in her party.


```{r}
ggplot(aes(x = contb_receipt_dt, y = contb_receipt_amt, color= cand_party),
       data = subset(capcf, contb_receipt_amt > 0 & contb_receipt_amt < 6000 &
                       contb_receipt_dt > as.Date("2015-01-01"))) +
    geom_point(alpha=0.3, position='jitter') +
    geom_smooth(formula = contb_receipt_amt ~ contb_receipt_dt) +
    scale_colour_manual(values=c("blue", "green", "red"))
```


    
# Multivariate Analysis

#### Talk about some of the relationships you observed in this part of the investigation. Were there features that strengthened each other in terms of looking at your feature(s) of interest?

#### Were there any interesting or surprising interactions between features?

#### OPTIONAL: Did you create any models with your dataset? Discuss the strengths and limitations of your model.

------

# Final Plots and Summary

### Plot One
```{r echo=FALSE, Plot_One}

```

### Description One


### Plot Two
```{r echo=FALSE, Plot_Two}

```

### Description Two


### Plot Three
```{r echo=FALSE, Plot_Three}

```

### Description Three

------

# Reflection
